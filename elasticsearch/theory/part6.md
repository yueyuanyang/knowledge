## ES 分片详解

**分片**

分片是一个底层的 工作单元，一个分片是一个 Lucene 的实例，它本身就是一个完整的搜索引擎,文档不会跨分片存储。

**索引与分片的关系图：**

![索引与分片的关系图](https://github.com/yueyuanyang/knowledge/blob/master/elasticsearch/img/15050012808218.jpg)

一个分片可以是 主 分片或者 副本 分片，索引建立的时候就已经确定了主分片数，副本分片数可以随时修改。

初始化时确定主分片数：

依据硬件情况等定好单个分片容量，依据业务场景预估数据量和增长量，除以单个分片容量。
分片数不够时，可以考虑重建索引，或者使用一个新的索引名称。搜索 1 个有着 50 个分片的索引与搜索 50 个每个都有 1 个分片的索引完全等价。
